description = "Uses the Playwright MCP server to find and record the steps for fetching bin data for a given postcode."
prompt = """
# Task: Record Bin Collector Steps and Scrape Bin Data via Playwright MCP

You are an agent that controls a web browser via a Playwright MCP server. Your goal is to navigate to a UK council's bin collection page, record the necessary interaction steps, scrape the upcoming bin collections, and save the resulting HAR file and collector info file.

**User Input (Postcode):** `{{args}}`

**Your Plan:**

1.  **Delete Existing HAR File:**
    *   Check if a requests HAR file already exists at the path `./.agent/playwright/out/requests.har`.
    *   If exists, delete it.

2.  **Find Council Website (Do Not Record Steps):**
    *   Connect to the Playwright MCP server.
    *   Navigate to `https://www.gov.uk/rubbish-collection-day`, enter the postcode `{{args}}`, and find the target council's website URL.
    *   Extract the council's name and its website URL.
    *   Create a `PascalCase` version of the council name (e.g., "Bristol City Council" -> "BristolCityCouncil") for use in filenames.

3.  **Navigate and Record Steps (Council Website):**
    *   Navigate to the specific page on the council's website for checking bin collections. This may be the URL you extracted directly, or you may need to click through from their homepage.
    *   **Begin recording steps here.** The first step in your recorded output must be the navigation to the page containing the postcode input field on the council's website.
    *   Record all subsequent user interactions as distinct steps: filling in the postcode, selecting an address from a list, and clicking buttons.

4.  **Scrape Bin Collection Data:**
    *   On the final page that displays the bin collections, parse the live HTML to extract the schedule.
    *   Analyze the page structure (tables `<table>`, divs `<div>`, lists `<ul>`/`<ol>`) to identify repeating elements representing collection days.
    *   For each collection, extract the date and the names/descriptions of the bins being collected.

5.  **Finalize & Save:**
    *   Close the Playwright browser session. The server is configured to automatically produce a HAR file at `./.agent/playwright/out/requests.har`.
    *   **Clean the HAR File:** Execute the Node.js script to clean the HAR file: `!{node ./.agent/scripts/clean-har.js ./.agent/playwright/out/requests.har ./.agent/playwright/out/{CouncilName}.cleaned.har}`
    *   **Define Collector Info & Bin Data:** Use the `write_file` tool to save a new JSON file at `./.agent/playwright/out/{CouncilName}.json`. This file must contain the following structure, populated with the information you have gathered. **The `steps` array must only contain the interactions with the council website.**

        ```json
        {
          "postcode": "...",
          "councilName": "...",
          "councilWebsite": "...",
          "govUkId": "...",
          "harFilePath": "./.agent/playwright/out/{CouncilName}.cleaned.har",
          "steps": [
            {
              "function": "goto",
              "destination": "https://council.website.com/bins",
              "name": null,
              "operation": null,
              "value": null
            }
          ],
          "collections": [
            {
              "Date": "YYYY-MM-DD",
              "Bins": [
                {
                  "Name": "Recycling",
                  "Colour": "Blue",
                  "Type": "Bin"
                }
              ]
            }
          ]
        }
        ```
    *   Report to the user that the files have been created successfully.

Begin now by connecting to the server and starting the navigation process.
"""